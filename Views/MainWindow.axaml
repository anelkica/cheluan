<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:AvaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
		xmlns:vm="using:cheluan.ViewModels"
		x:Class="cheluan.Views.MainWindow"
		x:DataType="vm:MainWindowViewModel"
		MinWidth="900" MinHeight="600"
		WindowStartupLocation="CenterScreen"
		ExtendClientAreaToDecorationsHint="True"
		ExtendClientAreaChromeHints="NoChrome"
		ExtendClientAreaTitleBarHeightHint="-1"
		FontFamily="Cascadia Code, JetBrains Mono, Consolas, monospace"
		Background="#181818"
		Foreground="{DynamicResource TextPrimary}"
		Title="cheluan">

	<Window.KeyBindings>
		<KeyBinding Gesture="Ctrl+S" Command="{Binding SaveFileCommand}" />
	</Window.KeyBindings>

	<Grid RowDefinitions="40, 38, *">
		<!-- TITLEBAR -->
		<Border Name="Titlebar" Grid.Row="0" Background="#1E1E1E" BorderBrush="#2B2B2B" BorderThickness="0,0,0,1"
				Padding="12,0,0,0" PointerPressed="Titlebar_PointerPressed">
			<Grid ColumnDefinitions="*, Auto">
				<!-- TITLE TEXT (LEFT) -->
				<TextBlock Grid.Column="0"
						   Text="{Binding TitlebarText}"
						   VerticalAlignment="Center"
						   Foreground="#888888"
						   FontSize="14"
						   FontWeight="Normal"
						   FontFamily="Cascadia Code, JetBrains Mono, Consolas, monospace" />

				<!-- WINDOW CONTROLS (RIGHT) -->
				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="0" VerticalAlignment="Stretch">
					<Button Name="MinimizeButton" Click="MinimizeButton_Click"
							Width="52" VerticalAlignment="Stretch" Padding="0"
							BorderThickness="0" CornerRadius="0"
							Content="—" FontSize="16" FontWeight="Light"/>

					<Button Name="MaximizeButton" Click="MaximizeButton_Click"
							Width="52" VerticalAlignment="Stretch" Padding="0"
							BorderThickness="0" CornerRadius="0"
							Content="□" FontSize="14" FontWeight="Light"/>

					<Button Name="CloseButton" Classes="Exit" Click="CloseButton_Click"
							Width="52" VerticalAlignment="Stretch" Padding="0"
							BorderThickness="0" CornerRadius="0"
							Content="✕" FontSize="14" FontWeight="Light"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- TOOLBAR -->
		<Border Grid.Row="1" Background="#1E1E1E" BorderBrush="#2B2B2B" BorderThickness="0,0,0,1">
			<Grid ColumnDefinitions="Auto, Auto, *, Auto" Margin="0,0,24,0">
				<StackPanel Grid.Column="0" Orientation="Horizontal">
					<Button Classes="Run" Content="▶ Run"
							Command="{Binding ExecuteCodeFromEditorCommand}"
							CommandParameter="{Binding #CodeEditor}" />
					<Button Classes="Tool" Content="Clear"
							Command="{Binding RequestCanvasClearCommand}" />
				</StackPanel>

				<StackPanel Grid.Column="1" Orientation="Horizontal">
					<Rectangle Width="1" Height="18" Fill="#333333" Margin="10,0"/>

					<Button Content="File" Classes="Tool">
						<Button.Flyout>
							<MenuFlyout Placement="BottomEdgeAlignedLeft">
								<MenuItem Header="New" Command="{Binding NewFileAsync}" />
								<MenuItem Header="Open..." Command="{Binding OpenFileAsync}" />
								<MenuItem Header="Save" Command="{Binding SaveFileAsync}" />
								<Separator />
								<MenuItem Header="Export Canvas" />
							</MenuFlyout>
						</Button.Flyout>
					</Button>
				</StackPanel>

				<StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
					
				</StackPanel>

			</Grid>
		</Border>

		<Grid Grid.Row="2" Margin="0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="1.2*" MinWidth="300" />
				<ColumnDefinition Width="2" />
				<ColumnDefinition Width="*" MinWidth="300" />
			</Grid.ColumnDefinitions>

			<!-- LUA CODE EDITOR -->
			<Border Grid.Column="0" VerticalAlignment="Stretch">
				<Grid RowDefinitions="34, *">
					<Border Grid.Row="0" Background="#252525" BorderThickness="0,0,0,1" BorderBrush="#2B2B2B">
						<TextBlock Text="Code Editor" TextAlignment="Center" VerticalAlignment="Center" />
					</Border>
					<AvaloniaEdit:TextEditor Grid.Row="1" Name="CodeEditor"
											 SyntaxHighlighting="Lua"
											 ShowLineNumbers="True"
											 Margin="6,0,0,0"
											 LineNumbersMargin="18,0,12,0"
											 FontSize="14"
											 FontFamily="Cascadia Code,Consolas,Monospace"
											 Background="Transparent"
											 Foreground="#D4D4D4">
					</AvaloniaEdit:TextEditor>
				</Grid>
			</Border>

			<GridSplitter Grid.Column="1" Background="#2B2B2B" HorizontalAlignment="Stretch" />


			<!-- TURTLE GRAPHICS CANVAS -->
			<Border Grid.Column="2" Background="#181818" ClipToBounds="True" VerticalAlignment="Stretch">
				<Grid RowDefinitions="34, *">
					<Border Grid.Row="0" Background="#252525" BorderThickness="0,0,0,1" BorderBrush="#2B2B2B">
						<TextBlock Text="Graphics Visualizer" TextAlignment="Center" VerticalAlignment="Center" />
					</Border>

					<Panel Grid.Row="1" VerticalAlignment="Stretch">
						<Viewbox Stretch="Uniform" Margin="40">
							<Border BorderBrush="#2B2B2B" BorderThickness="1">
								<Canvas Name="TurtleCanvas" Width="400" Height="400" />
							</Border>

						</Viewbox>

						<!-- BOTTOM RIGHT NOTIFICATION TOAST -->
						<Border IsVisible="{Binding Notification.IsVisible}"
								VerticalAlignment="Bottom" HorizontalAlignment="Right"
								Margin="20" Padding="14,10" CornerRadius="4"
								IsHitTestVisible="False" Opacity="0.95">
							<Border.Styles>
								<Style Selector="Border">
									<Setter Property="Background" Value="#252526"/>
									<Setter Property="BorderBrush" Value="#45634d"/>
									<Setter Property="BorderThickness" Value="1"/>
								</Style>
								<Style Selector="Border[Tag=True]">
									<Setter Property="BorderBrush" Value="#b34f4f"/>
								</Style>
							</Border.Styles>
							<Border.Tag>
								<Binding Path="Notification.IsError"/>
							</Border.Tag>
							<TextBlock Text="{Binding Notification.NotificationMessage}"
									   Foreground="White" FontSize="12" FontWeight="SemiBold"/>
						</Border>
					</Panel>
				</Grid>
			</Border>
		</Grid>
	</Grid>
</Window>